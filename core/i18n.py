TEXTS = {
    "ru": {
        "choose_lang": "ðŸŒ ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹Ðº:",
        "welcome_back": "ðŸ‘‹ Ð¡ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸ÐµÐ¼, {name}!",
        "enter_nick": "ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð’Ð²ÐµÐ´Ð¸ ÑÐ²Ð¾Ð¹ Ð½Ð¸Ðº:",
        "pick_theme": "Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÑƒÑŽÑ‰ÑƒÑŽ Ñ‚ÐµÐ¼Ñƒ:",
        "found": "ðŸŽ‰ Ð¡Ð¾Ð±ÐµÑÐµÐ´Ð½Ð¸Ðº Ð½Ð°Ð¹Ð´ÐµÐ½!\nÐ¢ÐµÐ¼Ð°: {theme}\nÐŸÐ¾Ð´Ñ‚ÐµÐ¼Ð°: {sub}\nÐ¯Ð·Ñ‹Ðº ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ°: {lang}",
        # ÐºÐ½Ð¾Ð¿ÐºÐ¸
        "btn_start": "ÐÐ°Ñ‡Ð°Ñ‚ÑŒ",
        "btn_search": "ðŸ” ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ð¾Ð¸ÑÐº",
        "btn_stop": "â›” ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð¸ÑÐº",
        "btn_change_sub": "Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ñ‚ÐµÐ¼Ñƒ",
        "btn_main_menu": "ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ",
        "btn_support": "â¤ï¸ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚",
    },
    "uk": {
        "choose_lang": "ðŸŒ Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð¾Ð±ÐµÑ€Ñ–Ñ‚ÑŒ Ð¼Ð¾Ð²Ñƒ:",
        "welcome_back": "ðŸ‘‹ Ð— Ð¿Ð¾Ð²ÐµÑ€Ð½ÐµÐ½Ð½ÑÐ¼, {name}!",
        "enter_nick": "ðŸ‘‹ ÐŸÑ€Ð¸Ð²Ñ–Ñ‚! Ð’Ð²ÐµÐ´Ð¸ ÑÐ²Ñ–Ð¹ Ð½Ñ–Ðº:",
        "pick_theme": "ÐžÐ±ÐµÑ€Ð¸ Ñ‚ÐµÐ¼Ñƒ:",
        "found": "ðŸŽ‰ Ð¡Ð¿Ñ–Ð²Ñ€Ð¾Ð·Ð¼Ð¾Ð²Ð½Ð¸ÐºÐ° Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾!\nÐ¢ÐµÐ¼Ð°: {theme}\nÐŸÑ–Ð´Ñ‚ÐµÐ¼Ð°: {sub}\nÐœÐ¾Ð²Ð° ÑÐ¿Ñ–Ð²Ñ€Ð¾Ð·Ð¼Ð¾Ð²Ð½Ð¸ÐºÐ°: {lang}",
        "btn_start": "ÐŸÐ¾Ñ‡Ð°Ñ‚Ð¸",
        "btn_search": "ðŸ” ÐŸÐ¾Ñ‡Ð°Ñ‚Ð¸ Ð¿Ð¾ÑˆÑƒÐº",
        "btn_stop": "â›” Ð—ÑƒÐ¿Ð¸Ð½Ð¸Ñ‚Ð¸ Ð¿Ð¾ÑˆÑƒÐº",
        "btn_change_sub": "Ð—Ð¼Ñ–Ð½Ð¸Ñ‚Ð¸ Ð¿Ñ–Ð´Ñ‚ÐµÐ¼Ñƒ",
        "btn_main_menu": "ðŸ  Ð“Ð¾Ð»Ð¾Ð²Ð½Ðµ Ð¼ÐµÐ½ÑŽ",
        "btn_support": "â¤ï¸ ÐŸÑ–Ð´Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚",
    },
    "en": {
        "choose_lang": "ðŸŒ Please choose your language:",
        "welcome_back": "ðŸ‘‹ Welcome back, {name}!",
        "enter_nick": "ðŸ‘‹ Hi! Enter your nickname:",
        "pick_theme": "Choose a topic:",
        "found": "ðŸŽ‰ Partner found!\nTopic: {theme}\nSubtopic: {sub}\nPartner language: {lang}",
        "btn_start": "Start",
        "btn_search": "ðŸ” Start search",
        "btn_stop": "â›” Stop search",
        "btn_change_sub": "Change subtopic",
        "btn_main_menu": "ðŸ  Main menu",
        "btn_support": "â¤ï¸ Support the project",
    },
    "es": {
        "choose_lang": "ðŸŒ Por favor, elige un idioma:",
        "welcome_back": "ðŸ‘‹ Â¡Bienvenido de nuevo, {name}!",
        "enter_nick": "ðŸ‘‹ Â¡Hola! Escribe tu apodo:",
        "pick_theme": "Elige un tema:",
        "found": "ðŸŽ‰ Â¡Pareja encontrada!\nTema: {theme}\nSubtema: {sub}\nIdioma del interlocutor: {lang}",
        "btn_start": "Comenzar",
        "btn_search": "ðŸ” Buscar",
        "btn_stop": "â›” Detener bÃºsqueda",
        "btn_change_sub": "Cambiar subtema",
        "btn_main_menu": "ðŸ  MenÃº principal",
        "btn_support": "â¤ï¸ Apoyar el proyecto",
    },
    "fr": {
        "choose_lang": "ðŸŒ Veuillez choisir votre langueÂ :",
        "welcome_back": "ðŸ‘‹ Bon retour, {name}Â !",
        "enter_nick": "ðŸ‘‹ SalutÂ ! Entrez votre pseudoÂ :",
        "pick_theme": "Choisissez un thÃ¨meÂ :",
        "found": "ðŸŽ‰ Partenaire trouvÃ©â€¯!\nThÃ¨meÂ : {theme}\nSousâ€‘thÃ¨meÂ : {sub}\nLangue du partenaireÂ : {lang}",
        "btn_start": "Commencer",
        "btn_search": "ðŸ” Lancer la recherche",
        "btn_stop": "â›” ArrÃªter la recherche",
        "btn_change_sub": "Changer le sousâ€‘thÃ¨me",
        "btn_main_menu": "ðŸ  Menu principal",
        "btn_support": "â¤ï¸ Soutenir le projet",
    },
    "de": {
        "choose_lang": "ðŸŒ Bitte wÃ¤hle eine Sprache:",
        "welcome_back": "ðŸ‘‹ Willkommen zurÃ¼ck, {name}!",
        "enter_nick": "ðŸ‘‹ Hallo! Gib deinen Nick ein:",
        "pick_theme": "WÃ¤hle ein Thema:",
        "found": "ðŸŽ‰ GesprÃ¤chspartner gefunden!\nThema: {theme}\nUnterthema: {sub}\nSprache des Partners: {lang}",
        "btn_start": "Start",
        "btn_search": "ðŸ” Suche starten",
        "btn_stop": "â›” Suche stoppen",
        "btn_change_sub": "Unterthema Ã¤ndern",
        "btn_main_menu": "ðŸ  HauptmenÃ¼",
        "btn_support": "â¤ï¸ Projekt unterstÃ¼tzen",
    },
}

def tr_lang(lang: str, key: str, **kw) -> str:
    lang = lang if lang in TEXTS else "ru"
    return TEXTS[lang].get(key, key).format(**kw)

async def tr(user, key: str, **kw) -> str:
    # user Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ dict (Ð¸Ð· get_user) Ð¸Ð»Ð¸ telegram.User
    lang = "ru"
    if isinstance(user, dict):
        lang = user.get("lang", "ru")
    elif hasattr(user, "id"):
        from db.user_queries import get_user
        row = await get_user(user.id)
        if row:
            lang = row.get("lang", "ru")
    return tr_lang(lang, key, **kw)
