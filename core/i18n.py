TEXTS = {
    "ru": {
        "choose_lang": "ğŸŒ ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹Ğº:",
        "welcome_back": "ğŸ‘‹ Ğ¡ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸ĞµĞ¼, {name}!",
        "enter_nick": "ğŸ‘‹ ĞŸÑ€Ğ¸Ğ²ĞµÑ‚! Ğ’Ğ²ĞµĞ´Ğ¸ ÑĞ²Ğ¾Ğ¹ Ğ½Ğ¸Ğº:",
        "pick_theme": "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑƒÑÑ‰ÑƒÑ Ñ‚ĞµĞ¼Ñƒ:",
        "choose_sub": "Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ñƒ:",
        "pick_sub": "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ñƒ:",
        "wrong_sub": "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ñƒ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ°.",
        "choose_gender": "Ğ£ĞºĞ°Ğ¶Ğ¸ ÑĞ²Ğ¾Ğ¹ Ğ¿Ğ¾Ğ»:",
        "wrong_gender": "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¿Ğ¾Ğ»:",
        "found": "ğŸ‰ Ğ¡Ğ¾Ğ±ĞµÑĞµĞ´Ğ½Ğ¸Ğº Ğ½Ğ°Ğ¹Ğ´ĞµĞ½!\nĞ¢ĞµĞ¼Ğ°: {theme}\nĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ°: {sub}\nĞ¯Ğ·Ñ‹Ğº ÑĞ¾Ğ±ĞµÑĞµĞ´Ğ½Ğ¸ĞºĞ°: {lang}",
        "main_menu": "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ:",
        "searching": "ğŸ” Ğ˜Ñ‰ĞµĞ¼ ÑĞ¾Ğ±ĞµÑĞµĞ´Ğ½Ğ¸ĞºĞ°...",
        "default_searching": "â³ Ğ˜Ñ‰ĞµĞ¼ ÑĞ¾Ğ±ĞµÑĞµĞ´Ğ½Ğ¸ĞºĞ°...",
        "search_stopped": "ĞŸĞ¾Ğ¸ÑĞº Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½.",
        "error_fallback": "âŒ Ğ§Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ¿Ğ¾ÑˆĞ»Ğ¾ Ğ½Ğµ Ñ‚Ğ°Ğº. ĞĞ°Ğ¿Ğ¸ÑˆĞ¸ /start.",
        "sub_any": "Ğ›ÑĞ±Ğ°Ñ Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ğ°",
        "support_thanks": "ğŸ™ Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ!\n(Ğ—Ğ´ĞµÑÑŒ Ğ±ÑƒĞ´ĞµÑ‚ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Ğ´Ğ¾Ğ½Ğ°Ñ‚)",

        # ĞšĞ½Ğ¾Ğ¿ĞºĞ¸
        "btn_start": "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ",
        "btn_search": "ğŸ” ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ¸ÑĞº",
        "btn_stop": "â›” ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ¸ÑĞº",
        "btn_change_sub": "Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ñƒ",
        "btn_main_menu": "ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ",
        "btn_support": "â¤ï¸ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚",
        "btn_end_dialog": "âŒ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³",
        "btn_new_partner": "ğŸ” ĞĞ¾Ğ²Ñ‹Ğ¹ ÑĞ¾Ğ±ĞµÑĞµĞ´Ğ½Ğ¸Ğº",
        "pls_start": "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ /start.",
        "btn_end": "âŒ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³",

        # ĞŸĞ¾Ğ»
        "gender_male": "ĞœÑƒĞ¶ÑĞºĞ¾Ğ¹",
        "gender_female": "Ğ–ĞµĞ½ÑĞºĞ¸Ğ¹",
        "gender_any": "ĞĞµ Ğ²Ğ°Ğ¶Ğ½Ğ¾",

        # Ğ’Ñ‹Ğ²Ğ¾Ğ´
        "confirm_theme": "Ğ’Ñ‹ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ»Ğ¸ Ñ‚ĞµĞ¼Ñƒ: {theme}",
        "confirm_sub": "Ğ˜ Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ñƒ: {sub}",
    },
    "uk": {
        "choose_lang": "ğŸŒ Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ¾Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ¼Ğ¾Ğ²Ñƒ:",
        "welcome_back": "ğŸ‘‹ Ğ— Ğ¿Ğ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½ÑĞ¼, {name}!",
        "enter_nick": "ğŸ‘‹ ĞŸÑ€Ğ¸Ğ²Ñ–Ñ‚! Ğ’Ğ²ĞµĞ´Ğ¸ ÑĞ²Ñ–Ğ¹ Ğ½Ñ–Ğº:",
        "pick_theme": "ĞĞ±ĞµÑ€Ğ¸ Ñ‚ĞµĞ¼Ñƒ:",
        "choose_sub": "Ğ¢ĞµĞ¿ĞµÑ€ Ğ¾Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ¿Ñ–Ğ´Ñ‚ĞµĞ¼Ñƒ:",
        "pick_sub": "ĞĞ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñƒ Ğ¿Ñ–Ğ´Ñ‚ĞµĞ¼Ñƒ:",
        "wrong_sub": "Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ¾Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ¿Ñ–Ğ´Ñ‚ĞµĞ¼Ñƒ Ğ·Ñ– ÑĞ¿Ğ¸ÑĞºÑƒ.",
        "choose_gender": "ĞĞ±ĞµÑ€Ñ–Ñ‚ÑŒ ÑĞ²Ğ¾Ñ ÑÑ‚Ğ°Ñ‚ÑŒ:",
        "wrong_gender": "Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ¾Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑŒ:",
        "found": "ğŸ‰ Ğ¡Ğ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸ĞºĞ° Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾!\nĞ¢ĞµĞ¼Ğ°: {theme}\nĞŸÑ–Ğ´Ñ‚ĞµĞ¼Ğ°: {sub}\nĞœĞ¾Ğ²Ğ° ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸ĞºĞ°: {lang}",
        "main_menu": "ĞĞ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ´Ñ–Ñ:",
        "searching": "ğŸ” ĞŸĞ¾ÑˆÑƒĞº ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸ĞºĞ°...",
        "default_searching": "â³ ĞŸĞ¾ÑˆÑƒĞº Ñ‚Ñ€Ğ¸Ğ²Ğ°Ñ”...",
        "search_stopped": "ĞŸĞ¾ÑˆÑƒĞº Ğ·ÑƒĞ¿Ğ¸Ğ½ĞµĞ½Ğ¾.",
        "error_fallback": "âŒ Ğ©Ğ¾ÑÑŒ Ğ¿Ñ–ÑˆĞ»Ğ¾ Ğ½Ğµ Ñ‚Ğ°Ğº. ĞĞ°Ğ¿Ğ¸ÑˆÑ–Ñ‚ÑŒ /start.",
        "sub_any": "Ğ‘ÑƒĞ´ÑŒ-ÑĞºĞ° Ğ¿Ñ–Ğ´Ñ‚ĞµĞ¼Ğ°",
        "support_thanks": "ğŸ™ Ğ”ÑĞºÑƒÑ”Ğ¼Ğ¾ Ğ·Ğ° Ğ¿Ñ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºÑƒ!\n(Ğ¢ÑƒÑ‚ Ğ±ÑƒĞ´Ğµ Ğ¿Ğ¾ÑĞ¸Ğ»Ğ°Ğ½Ğ½Ñ Ğ½Ğ° Ğ´Ğ¾Ğ½Ğ°Ñ‚)",

        "btn_start": "ĞŸĞ¾Ñ‡Ğ°Ñ‚Ğ¸",
        "btn_search": "ğŸ” ĞŸĞ¾Ñ‡Ğ°Ñ‚Ğ¸ Ğ¿Ğ¾ÑˆÑƒĞº",
        "btn_stop": "â›” Ğ—ÑƒĞ¿Ğ¸Ğ½Ğ¸Ñ‚Ğ¸ Ğ¿Ğ¾ÑˆÑƒĞº",
        "btn_change_sub": "Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ğ¿Ñ–Ğ´Ñ‚ĞµĞ¼Ñƒ",
        "btn_main_menu": "ğŸ  Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğµ Ğ¼ĞµĞ½Ñ",
        "btn_support": "â¤ï¸ ĞŸÑ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚",
        "btn_end_dialog": "âŒ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚Ğ¸ Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³",
        "btn_new_partner": "ğŸ” ĞĞ¾Ğ²Ğ¸Ğ¹ ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸Ğº",
        "pls_start": "Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ½Ğ°Ğ´Ñ–ÑˆĞ»Ñ–Ñ‚ÑŒ /start.",
        "btn_end": "âŒ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚Ğ¸ Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³",

        "gender_male": "Ğ§Ğ¾Ğ»Ğ¾Ğ²Ñ–Ñ‡Ğ°",
        "gender_female": "Ğ–Ñ–Ğ½Ğ¾Ñ‡Ğ°",
        "gender_any": "ĞĞµĞ²Ğ°Ğ¶Ğ»Ğ¸Ğ²Ğ¾",

        "confirm_theme": "Ğ’Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ»Ğ¸ Ñ‚ĞµĞ¼Ñƒ: {theme}",
        "confirm_sub": "Ğ¢Ğ° Ğ¿Ñ–Ğ´Ñ‚ĞµĞ¼Ñƒ: {sub}",
        
    },
    "en": {
        "choose_lang": "ğŸŒ Please choose your language:",
        "welcome_back": "ğŸ‘‹ Welcome back, {name}!",
        "enter_nick": "ğŸ‘‹ Hi! Enter your nickname:",
        "pick_theme": "Choose a topic:",
        "choose_sub": "Now choose a subtopic:",
        "pick_sub": "Select a new subtopic:",
        "wrong_sub": "Please select a subtopic from the list.",
        "choose_gender": "Select your gender:",
        "wrong_gender": "Please select your gender:",
        "found": "ğŸ‰ Partner found!\nTopic: {theme}\nSubtopic: {sub}\nPartner language: {lang}",
        "main_menu": "Choose an action:",
        "searching": "ğŸ” Looking for a partner...",
        "default_searching": "â³ Still looking for a partner...",
        "search_stopped": "Search stopped.",
        "error_fallback": "âŒ Something went wrong. Please send /start.",
        "sub_any": "Any subtopic",
        "support_thanks": "ğŸ™ Thanks for your support!\n(A donation link will appear here)",

        "btn_start": "Start",
        "btn_search": "ğŸ” Start search",
        "btn_stop": "â›” Stop search",
        "btn_change_sub": "Change subtopic",
        "btn_main_menu": "ğŸ  Main menu",
        "btn_support": "â¤ï¸ Support the project",
        "btn_end_dialog": "âŒ End chat",
        "btn_new_partner": "ğŸ” New partner",
        "pls_start": "Please send /start.",
        "btn_end": "âŒ End chat",

        "gender_male": "Male",
        "gender_female": "Female",
        "gender_any": "Doesn't matter",

        "confirm_theme": "You selected the topic: {theme}",
        "confirm_sub": "And the subtopic: {sub}",
        
    },
    "es": {
        "choose_lang": "ğŸŒ Por favor, elige un idioma:",
        "welcome_back": "ğŸ‘‹ Â¡Bienvenido de nuevo, {name}!",
        "enter_nick": "ğŸ‘‹ Â¡Hola! Escribe tu apodo:",
        "pick_theme": "Elige un tema:",
        "choose_sub": "Ahora elige un subtema:",
        "pick_sub": "Elige un nuevo subtema:",
        "wrong_sub": "Por favor, elige un subtema de la lista.",
        "choose_gender": "Selecciona tu gÃ©nero:",
        "wrong_gender": "Por favor, selecciona tu gÃ©nero:",
        "found": "ğŸ‰ Â¡Pareja encontrada!\nTema: {theme}\nSubtema: {sub}\nIdioma del interlocutor: {lang}",
        "main_menu": "Elige una acciÃ³n:",
        "searching": "ğŸ” Buscando compaÃ±ero...",
        "default_searching": "â³ Buscando compaÃ±ero...",
        "search_stopped": "BÃºsqueda detenida.",
        "error_fallback": "âŒ Algo saliÃ³ mal. Escribe /start.",
        "sub_any": "Cualquier subtema",
        "support_thanks": "ğŸ™ Â¡Gracias por tu apoyo!\n(AquÃ­ aparecerÃ¡ el enlace de donaciÃ³n)",

        "btn_start": "Comenzar",
        "btn_search": "ğŸ” Buscar",
        "btn_stop": "â›” Detener bÃºsqueda",
        "btn_change_sub": "Cambiar subtema",
        "btn_main_menu": "ğŸ  MenÃº principal",
        "btn_support": "â¤ï¸ Apoyar el proyecto",
        "btn_end_dialog": "âŒ Terminar chat",
        "btn_new_partner": "ğŸ” Nueva pareja",
        "pls_start": "Por favor, envÃ­a /start.",
        "btn_end": "âŒ Terminar chat",

        "gender_male": "Masculino",
        "gender_female": "Femenino",
        "gender_any": "No importa",

        "confirm_theme": "Has elegido el tema: {theme}",
        "confirm_sub": "Y el subtema: {sub}",
        
    },
    "fr": {
        "choose_lang": "ğŸŒ Veuillez choisir votre langueÂ :",
        "welcome_back": "ğŸ‘‹ Bon retour, {name}Â !",
        "enter_nick": "ğŸ‘‹ SalutÂ ! Entrez votre pseudoÂ :",
        "pick_theme": "Choisissez un thÃ¨meÂ :",
        "choose_sub": "Choisis maintenant une sous-thÃ¨meÂ :",
        "pick_sub": "Choisissez une nouvelle sous-thÃ¨meÂ :",
        "wrong_sub": "Veuillez choisir une sous-thÃ¨me dans la liste.",
        "choose_gender": "Indique ton sexeÂ :",
        "wrong_gender": "Veuillez choisir votre sexeÂ :",
        "found": "ğŸ‰ Partenaire trouvÃ©â€¯!\nThÃ¨meÂ : {theme}\nSousâ€‘thÃ¨meÂ : {sub}\nLangue du partenaireÂ : {lang}",
        "main_menu": "Choisissez une actionÂ :",
        "searching": "ğŸ” Recherche dâ€™un partenaire...",
        "default_searching": "â³ Recherche en cours...",
        "search_stopped": "Recherche arrÃªtÃ©e.",
        "error_fallback": "âŒ Une erreur est survenue. Envoyez /start.",
        "sub_any": "Nâ€™importe quel sous-thÃ¨me",
        "support_thanks": "ğŸ™ Merci pour votre soutien !\n(Un lien de don apparaÃ®tra ici)",

        "btn_start": "Commencer",
        "btn_search": "ğŸ” Lancer la recherche",
        "btn_stop": "â›” ArrÃªter la recherche",
        "btn_change_sub": "Changer le sousâ€‘thÃ¨me",
        "btn_main_menu": "ğŸ  Menu principal",
        "btn_support": "â¤ï¸ Soutenir le projet",
        "btn_end_dialog": "âŒ Terminer la discussion",
        "btn_new_partner": "ğŸ” Nouveau partenaire",
        "pls_start": "Veuillez envoyer /start.",
        "btn_end": "âŒ Terminer la discussion",

        "gender_male": "Homme",
        "gender_female": "Femme",
        "gender_any": "Peu importe",

        "confirm_theme": "Vous avez choisi le thÃ¨me : {theme}",
        "confirm_sub": "Et le sous-thÃ¨me : {sub}",
        
    },
    "de": {
        "choose_lang": "ğŸŒ Bitte wÃ¤hle eine Sprache:",
        "welcome_back": "ğŸ‘‹ Willkommen zurÃ¼ck, {name}!",
        "enter_nick": "ğŸ‘‹ Hallo! Gib deinen Nick ein:",
        "pick_theme": "WÃ¤hle ein Thema:",
        "choose_sub": "WÃ¤hle jetzt ein Unterthema:",
        "pick_sub": "WÃ¤hle ein neues Unterthema:",
        "wrong_sub": "Bitte wÃ¤hle ein Unterthema aus der Liste.",
        "choose_gender": "WÃ¤hle dein Geschlecht:",
        "wrong_gender": "Bitte wÃ¤hle dein Geschlecht:",
        "found": "ğŸ‰ GesprÃ¤chspartner gefunden!\nThema: {theme}\nUnterthema: {sub}\nSprache des Partners: {lang}",
        "main_menu": "WÃ¤hle eine Aktion:",
        "searching": "ğŸ” Suche nach GesprÃ¤chspartner...",
        "default_searching": "â³ Suche lÃ¤uft...",
        "search_stopped": "Suche gestoppt.",
        "error_fallback": "âŒ Etwas ist schiefgelaufen. Sende /start.",
        "sub_any": "Beliebiges Unterthema",
        "support_thanks": "ğŸ™ Vielen Dank fÃ¼r deine UnterstÃ¼tzung!\n(Hier erscheint ein Spendenlink)",

        "btn_start": "Start",
        "btn_search": "ğŸ” Suche starten",
        "btn_stop": "â›” Suche stoppen",
        "btn_change_sub": "Unterthema Ã¤ndern",
        "btn_main_menu": "ğŸ  HauptmenÃ¼",
        "btn_support": "â¤ï¸ Projekt unterstÃ¼tzen",
        "btn_end_dialog": "âŒ GesprÃ¤ch beenden",
        "btn_new_partner": "ğŸ” Neuer Partner",
        "pls_start": "Bitte sende /start.",
        "btn_end": "âŒ Chat beenden",

        "gender_male": "MÃ¤nnlich",
        "gender_female": "Weiblich",
        "gender_any": "Egal",

        "confirm_theme": "Du hast das Thema gewÃ¤hlt: {theme}",
        "confirm_sub": "Und das Unterthema: {sub}",
        
    },
}

def tr_lang(lang: str, key: str, **kw) -> str:
    lang = lang if lang in TEXTS else "ru"
    return TEXTS[lang].get(key, key).format(**kw)

async def tr(user, key: str, **kw) -> str:
    lang = "ru"
    if isinstance(user, dict):
        lang = user.get("lang", "ru")
    elif hasattr(user, "id"):
        from db.user_queries import get_user
        row = await get_user(user.id)
        if row:
            lang = row.get("lang", "ru")
    return tr_lang(lang, key, **kw)

async def tr_user(user_obj, key: str, **kw) -> str:
    return await tr(user_obj, key, **kw)
