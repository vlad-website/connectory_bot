TEXTS = {
    "ru": {
        "choose_lang": "ðŸŒ ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹Ðº:",
        "welcome_back": "ðŸ‘‹ Ð¡ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸ÐµÐ¼, {name}!",
        "enter_nick": "ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð’Ð²ÐµÐ´Ð¸ ÑÐ²Ð¾Ð¹ Ð½Ð¸Ðº:",
        "pick_theme": "Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÑƒÑŽÑ‰ÑƒÑŽ Ñ‚ÐµÐ¼Ñƒ:",
        "found": "ðŸŽ‰ Ð¡Ð¾Ð±ÐµÑÐµÐ´Ð½Ð¸Ðº Ð½Ð°Ð¹Ð´ÐµÐ½!\nÐ¢ÐµÐ¼Ð°: {theme}\nÐŸÐ¾Ð´Ñ‚ÐµÐ¼Ð°: {sub}\nÐ¯Ð·Ñ‹Ðº ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ°: {lang}",
        # ÐºÐ½Ð¾Ð¿ÐºÐ¸
        "btn_start": "ÐÐ°Ñ‡Ð°Ñ‚ÑŒ",
        "btn_search": "ðŸ” ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ð¾Ð¸ÑÐº",
        "btn_stop": "â›” ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð¸ÑÐº",
        "btn_change_sub": "Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ñ‚ÐµÐ¼Ñƒ",
        "btn_main_menu": "ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ",
        "btn_support": "â¤ï¸ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚",
        "choose_gender": "Ð£ÐºÐ°Ð¶Ð¸ ÑÐ²Ð¾Ð¹ Ð¿Ð¾Ð»:",
        "wrong_gender": "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ð¾Ð»:",
        "choose_sub": "Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ð¾Ð´Ñ‚ÐµÐ¼Ñƒ:",
        "wrong_sub": "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ð¾Ð´Ñ‚ÐµÐ¼Ñƒ Ð¸Ð· ÑÐ¿Ð¸ÑÐºÐ°.",
        "searching": "ðŸ”Ž Ð˜Ñ‰ÐµÐ¼ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ°...",
        "search_stopped": "ÐŸÐ¾Ð¸ÑÐº Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½.",
        "main_menu": "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:",
        "pick_sub": "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½Ð¾Ð²ÑƒÑŽ Ð¿Ð¾Ð´Ñ‚ÐµÐ¼Ñƒ:",
        "default_searching": "â³ Ð˜Ñ‰ÐµÐ¼ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ°...",
        "error_fallback": "âŒ Ð§Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº. ÐÐ°Ð¿Ð¸ÑˆÐ¸ /start.",
    },
    "uk": {
        "choose_lang": "ðŸŒ Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð¾Ð±ÐµÑ€Ñ–Ñ‚ÑŒ Ð¼Ð¾Ð²Ñƒ:",
        "welcome_back": "ðŸ‘‹ Ð— Ð¿Ð¾Ð²ÐµÑ€Ð½ÐµÐ½Ð½ÑÐ¼, {name}!",
        "enter_nick": "ðŸ‘‹ ÐŸÑ€Ð¸Ð²Ñ–Ñ‚! Ð’Ð²ÐµÐ´Ð¸ ÑÐ²Ñ–Ð¹ Ð½Ñ–Ðº:",
        "pick_theme": "ÐžÐ±ÐµÑ€Ð¸ Ñ‚ÐµÐ¼Ñƒ:",
        "found": "ðŸŽ‰ Ð¡Ð¿Ñ–Ð²Ñ€Ð¾Ð·Ð¼Ð¾Ð²Ð½Ð¸ÐºÐ° Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾!\nÐ¢ÐµÐ¼Ð°: {theme}\nÐŸÑ–Ð´Ñ‚ÐµÐ¼Ð°: {sub}\nÐœÐ¾Ð²Ð° ÑÐ¿Ñ–Ð²Ñ€Ð¾Ð·Ð¼Ð¾Ð²Ð½Ð¸ÐºÐ°: {lang}",
        "btn_start": "ÐŸÐ¾Ñ‡Ð°Ñ‚Ð¸",
        "btn_search": "ðŸ” ÐŸÐ¾Ñ‡Ð°Ñ‚Ð¸ Ð¿Ð¾ÑˆÑƒÐº",
        "btn_stop": "â›” Ð—ÑƒÐ¿Ð¸Ð½Ð¸Ñ‚Ð¸ Ð¿Ð¾ÑˆÑƒÐº",
        "btn_change_sub": "Ð—Ð¼Ñ–Ð½Ð¸Ñ‚Ð¸ Ð¿Ñ–Ð´Ñ‚ÐµÐ¼Ñƒ",
        "btn_main_menu": "ðŸ  Ð“Ð¾Ð»Ð¾Ð²Ð½Ðµ Ð¼ÐµÐ½ÑŽ",
        "btn_support": "â¤ï¸ ÐŸÑ–Ð´Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚",
        "choose_gender": "ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ ÑÐ²Ð¾ÑŽ ÑÑ‚Ð°Ñ‚ÑŒ:",
        "wrong_gender": "Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð¾Ð±ÐµÑ€Ñ–Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑŒ:",
        "choose_sub": "Ð¢ÐµÐ¿ÐµÑ€ Ð¾Ð±ÐµÑ€Ñ–Ñ‚ÑŒ Ð¿Ñ–Ð´Ñ‚ÐµÐ¼Ñƒ:",
        "wrong_sub": "Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð¾Ð±ÐµÑ€Ñ–Ñ‚ÑŒ Ð¿Ñ–Ð´Ñ‚ÐµÐ¼Ñƒ Ð·Ñ– ÑÐ¿Ð¸ÑÐºÑƒ.",
        "searching": "ðŸ”Ž ÐŸÐ¾ÑˆÑƒÐº ÑÐ¿Ñ–Ð²Ñ€Ð¾Ð·Ð¼Ð¾Ð²Ð½Ð¸ÐºÐ°...",
        "search_stopped": "ÐŸÐ¾ÑˆÑƒÐº Ð·ÑƒÐ¿Ð¸Ð½ÐµÐ½Ð¾.",
        "main_menu": "ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ð´Ñ–ÑŽ:",
        "pick_sub": "ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ð½Ð¾Ð²Ñƒ Ð¿Ñ–Ð´Ñ‚ÐµÐ¼Ñƒ:",
        "default_searching": "â³ ÐŸÐ¾ÑˆÑƒÐº Ñ‚Ñ€Ð¸Ð²Ð°Ñ”...",
        "error_fallback": "âŒ Ð©Ð¾ÑÑŒ Ð¿Ñ–ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº. ÐÐ°Ð¿Ð¸ÑˆÑ–Ñ‚ÑŒ /start.",
    },
    "en": {
        "choose_lang": "ðŸŒ Please choose your language:",
        "welcome_back": "ðŸ‘‹ Welcome back, {name}!",
        "enter_nick": "ðŸ‘‹ Hi! Enter your nickname:",
        "pick_theme": "Choose a topic:",
        "found": "ðŸŽ‰ Partner found!\nTopic: {theme}\nSubtopic: {sub}\nPartner language: {lang}",
        "btn_start": "Start",
        "btn_search": "ðŸ” Start search",
        "btn_stop": "â›” Stop search",
        "btn_change_sub": "Change subtopic",
        "btn_main_menu": "ðŸ  Main menu",
        "btn_support": "â¤ï¸ Support the project",
        "choose_gender": "Select your gender:",
        "wrong_gender": "Please select your gender:",
        "choose_sub": "Now choose a subtopic:",
        "wrong_sub": "Please select a subtopic from the list.",
        "searching": "ðŸ”Ž Looking for a partner...",
        "search_stopped": "Search stopped.",
        "main_menu": "Choose an action:",
        "pick_sub": "Select a new subtopic:",
        "default_searching": "â³ Still looking for a partner...",
        "error_fallback": "âŒ Something went wrong. Please send /start.",
    },
    "es": {
        "choose_lang": "ðŸŒ Por favor, elige un idioma:",
        "welcome_back": "ðŸ‘‹ Â¡Bienvenido de nuevo, {name}!",
        "enter_nick": "ðŸ‘‹ Â¡Hola! Escribe tu apodo:",
        "pick_theme": "Elige un tema:",
        "found": "ðŸŽ‰ Â¡Pareja encontrada!\nTema: {theme}\nSubtema: {sub}\nIdioma del interlocutor: {lang}",
        "btn_start": "Comenzar",
        "btn_search": "ðŸ” Buscar",
        "btn_stop": "â›” Detener bÃºsqueda",
        "btn_change_sub": "Cambiar subtema",
        "btn_main_menu": "ðŸ  MenÃº principal",
        "btn_support": "â¤ï¸ Apoyar el proyecto",
        "choose_gender": "Selecciona tu gÃ©nero:",
        "wrong_gender": "Por favor, selecciona tu gÃ©nero:",
        "choose_sub": "Ahora elige un subtema:",
        "wrong_sub": "Por favor, elige un subtema de la lista.",
        "searching": "ðŸ”Ž Buscando compaÃ±ero...",
        "search_stopped": "BÃºsqueda detenida.",
        "main_menu": "Elige una acciÃ³n:",
        "pick_sub": "Elige un nuevo subtema:",
        "default_searching": "â³ Buscando compaÃ±ero...",
        "error_fallback": "âŒ Algo saliÃ³ mal. Escribe /start.",
    },
    "fr": {
        "choose_lang": "ðŸŒ Veuillez choisir votre langueÂ :",
        "welcome_back": "ðŸ‘‹ Bon retour, {name}Â !",
        "enter_nick": "ðŸ‘‹ SalutÂ ! Entrez votre pseudoÂ :",
        "pick_theme": "Choisissez un thÃ¨meÂ :",
        "found": "ðŸŽ‰ Partenaire trouvÃ©â€¯!\nThÃ¨meÂ : {theme}\nSousâ€‘thÃ¨meÂ : {sub}\nLangue du partenaireÂ : {lang}",
        "btn_start": "Commencer",
        "btn_search": "ðŸ” Lancer la recherche",
        "btn_stop": "â›” ArrÃªter la recherche",
        "btn_change_sub": "Changer le sousâ€‘thÃ¨me",
        "btn_main_menu": "ðŸ  Menu principal",
        "btn_support": "â¤ï¸ Soutenir le projet",
        "choose_gender": "Indique ton sexeÂ :",
        "wrong_gender": "Veuillez choisir votre sexeÂ :",
        "choose_sub": "Choisis maintenant une sous-thÃ¨meÂ :",
        "wrong_sub": "Veuillez choisir une sous-thÃ¨me dans la liste.",
        "searching": "ðŸ”Ž Recherche dâ€™un partenaire...",
        "search_stopped": "Recherche arrÃªtÃ©e.",
        "main_menu": "Choisissez une actionÂ :",
        "pick_sub": "Choisissez une nouvelle sous-thÃ¨meÂ :",
        "default_searching": "â³ Recherche en cours...",
        "error_fallback": "âŒ Une erreur est survenue. Envoyez /start.",
    },
    "de": {
        "choose_lang": "ðŸŒ Bitte wÃ¤hle eine Sprache:",
        "welcome_back": "ðŸ‘‹ Willkommen zurÃ¼ck, {name}!",
        "enter_nick": "ðŸ‘‹ Hallo! Gib deinen Nick ein:",
        "pick_theme": "WÃ¤hle ein Thema:",
        "found": "ðŸŽ‰ GesprÃ¤chspartner gefunden!\nThema: {theme}\nUnterthema: {sub}\nSprache des Partners: {lang}",
        "btn_start": "Start",
        "btn_search": "ðŸ” Suche starten",
        "btn_stop": "â›” Suche stoppen",
        "btn_change_sub": "Unterthema Ã¤ndern",
        "btn_main_menu": "ðŸ  HauptmenÃ¼",
        "btn_support": "â¤ï¸ Projekt unterstÃ¼tzen",
        "choose_gender": "WÃ¤hle dein Geschlecht:",
        "wrong_gender": "Bitte wÃ¤hle dein Geschlecht:",
        "choose_sub": "WÃ¤hle jetzt ein Unterthema:",
        "wrong_sub": "Bitte wÃ¤hle ein Unterthema aus der Liste.",
        "searching": "ðŸ”Ž Suche nach GesprÃ¤chspartner...",
        "search_stopped": "Suche gestoppt.",
        "main_menu": "WÃ¤hle eine Aktion:",
        "pick_sub": "WÃ¤hle ein neues Unterthema:",
        "default_searching": "â³ Suche lÃ¤uft...",
        "error_fallback": "âŒ Etwas ist schiefgelaufen. Sende /start.",
    },
}

def tr_lang(lang: str, key: str, **kw) -> str:
    lang = lang if lang in TEXTS else "ru"
    return TEXTS[lang].get(key, key).format(**kw)

async def tr(user, key: str, **kw) -> str:
    # user Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ dict (Ð¸Ð· get_user) Ð¸Ð»Ð¸ telegram.User
    lang = "ru"
    if isinstance(user, dict):
        lang = user.get("lang", "ru")
    elif hasattr(user, "id"):
        from db.user_queries import get_user
        row = await get_user(user.id)
        if row:
            lang = row.get("lang", "ru")
    return tr_lang(lang, key, **kw)
