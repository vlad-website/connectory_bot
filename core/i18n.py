TEXTS = {
    "ru": {
        "choose_lang": "ðŸŒ ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹Ðº:",
        "welcome_back": "ðŸ‘‹ Ð¡ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸ÐµÐ¼, {name}!",
        "enter_nick": "ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð’Ð²ÐµÐ´Ð¸ ÑÐ²Ð¾Ð¹ Ð½Ð¸Ðº:",
        "pick_theme": "Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÑƒÑŽÑ‰ÑƒÑŽ Ñ‚ÐµÐ¼Ñƒ:",
        "choose_sub": "Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ð¾Ð´Ñ‚ÐµÐ¼Ñƒ:",
        "pick_sub": "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½Ð¾Ð²ÑƒÑŽ Ð¿Ð¾Ð´Ñ‚ÐµÐ¼Ñƒ:",
        "wrong_sub": "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ð¾Ð´Ñ‚ÐµÐ¼Ñƒ Ð¸Ð· ÑÐ¿Ð¸ÑÐºÐ°.",
        "choose_gender": "Ð£ÐºÐ°Ð¶Ð¸ ÑÐ²Ð¾Ð¹ Ð¿Ð¾Ð»:",
        "wrong_gender": "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ð¾Ð»:",
        "found": "ðŸŽ‰ Ð¡Ð¾Ð±ÐµÑÐµÐ´Ð½Ð¸Ðº Ð½Ð°Ð¹Ð´ÐµÐ½!\nÐ¢ÐµÐ¼Ð°: {theme}\nÐŸÐ¾Ð´Ñ‚ÐµÐ¼Ð°: {sub}\nÐ¯Ð·Ñ‹Ðº ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ°: {lang}",
        "main_menu": "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:",
        "searching": "ðŸ”Ž Ð˜Ñ‰ÐµÐ¼ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ°...",
        "default_searching": "â³ Ð˜Ñ‰ÐµÐ¼ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ°...",
        "search_stopped": "ÐŸÐ¾Ð¸ÑÐº Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½.",
        "error_fallback": "âŒ Ð§Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº. ÐÐ°Ð¿Ð¸ÑˆÐ¸ /start.",
        "sub_any": "Ð›ÑŽÐ±Ð°Ñ Ð¿Ð¾Ð´Ñ‚ÐµÐ¼Ð°",
        "support_thanks": "ðŸ™ Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ!\n(Ð—Ð´ÐµÑÑŒ Ð±ÑƒÐ´ÐµÑ‚ ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð´Ð¾Ð½Ð°Ñ‚)",

        # ÐšÐ½Ð¾Ð¿ÐºÐ¸
        "btn_start": "ÐÐ°Ñ‡Ð°Ñ‚ÑŒ",
        "btn_search": "ðŸ” ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ð¾Ð¸ÑÐº",
        "btn_stop": "â›” ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð¸ÑÐº",
        "btn_change_sub": "Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ñ‚ÐµÐ¼Ñƒ",
        "btn_main_menu": "ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ",
        "btn_support": "â¤ï¸ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚",
        "btn_end_dialog": "âŒ Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ð´Ð¸Ð°Ð»Ð¾Ð³",
        "btn_new_partner": "ðŸ” ÐÐ¾Ð²Ñ‹Ð¹ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸Ðº",
        "pls_start": "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ /start.",
        "btn_end": "âŒ Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ð´Ð¸Ð°Ð»Ð¾Ð³",

        # ÐŸÐ¾Ð»
        "gender_male": "ÐœÑƒÐ¶ÑÐºÐ¾Ð¹",
        "gender_female": "Ð–ÐµÐ½ÑÐºÐ¸Ð¹",
        "gender_any": "ÐÐµ Ð²Ð°Ð¶Ð½Ð¾",
    },
    "uk": {
        "choose_lang": "ðŸŒ Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð¾Ð±ÐµÑ€Ñ–Ñ‚ÑŒ Ð¼Ð¾Ð²Ñƒ:",
        "welcome_back": "ðŸ‘‹ Ð— Ð¿Ð¾Ð²ÐµÑ€Ð½ÐµÐ½Ð½ÑÐ¼, {name}!",
        "enter_nick": "ðŸ‘‹ ÐŸÑ€Ð¸Ð²Ñ–Ñ‚! Ð’Ð²ÐµÐ´Ð¸ ÑÐ²Ñ–Ð¹ Ð½Ñ–Ðº:",
        "pick_theme": "ÐžÐ±ÐµÑ€Ð¸ Ñ‚ÐµÐ¼Ñƒ:",
        "choose_sub": "Ð¢ÐµÐ¿ÐµÑ€ Ð¾Ð±ÐµÑ€Ñ–Ñ‚ÑŒ Ð¿Ñ–Ð´Ñ‚ÐµÐ¼Ñƒ:",
        "pick_sub": "ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ð½Ð¾Ð²Ñƒ Ð¿Ñ–Ð´Ñ‚ÐµÐ¼Ñƒ:",
        "wrong_sub": "Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð¾Ð±ÐµÑ€Ñ–Ñ‚ÑŒ Ð¿Ñ–Ð´Ñ‚ÐµÐ¼Ñƒ Ð·Ñ– ÑÐ¿Ð¸ÑÐºÑƒ.",
        "choose_gender": "ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ ÑÐ²Ð¾ÑŽ ÑÑ‚Ð°Ñ‚ÑŒ:",
        "wrong_gender": "Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð¾Ð±ÐµÑ€Ñ–Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑŒ:",
        "found": "ðŸŽ‰ Ð¡Ð¿Ñ–Ð²Ñ€Ð¾Ð·Ð¼Ð¾Ð²Ð½Ð¸ÐºÐ° Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾!\nÐ¢ÐµÐ¼Ð°: {theme}\nÐŸÑ–Ð´Ñ‚ÐµÐ¼Ð°: {sub}\nÐœÐ¾Ð²Ð° ÑÐ¿Ñ–Ð²Ñ€Ð¾Ð·Ð¼Ð¾Ð²Ð½Ð¸ÐºÐ°: {lang}",
        "main_menu": "ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ð´Ñ–ÑŽ:",
        "searching": "ðŸ”Ž ÐŸÐ¾ÑˆÑƒÐº ÑÐ¿Ñ–Ð²Ñ€Ð¾Ð·Ð¼Ð¾Ð²Ð½Ð¸ÐºÐ°...",
        "default_searching": "â³ ÐŸÐ¾ÑˆÑƒÐº Ñ‚Ñ€Ð¸Ð²Ð°Ñ”...",
        "search_stopped": "ÐŸÐ¾ÑˆÑƒÐº Ð·ÑƒÐ¿Ð¸Ð½ÐµÐ½Ð¾.",
        "error_fallback": "âŒ Ð©Ð¾ÑÑŒ Ð¿Ñ–ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº. ÐÐ°Ð¿Ð¸ÑˆÑ–Ñ‚ÑŒ /start.",
        "sub_any": "Ð‘ÑƒÐ´ÑŒ-ÑÐºÐ° Ð¿Ñ–Ð´Ñ‚ÐµÐ¼Ð°",
        "support_thanks": "ðŸ™ Ð”ÑÐºÑƒÑ”Ð¼Ð¾ Ð·Ð° Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÑƒ!\n(Ð¢ÑƒÑ‚ Ð±ÑƒÐ´Ðµ Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð½Ð° Ð´Ð¾Ð½Ð°Ñ‚)",

        "btn_start": "ÐŸÐ¾Ñ‡Ð°Ñ‚Ð¸",
        "btn_search": "ðŸ” ÐŸÐ¾Ñ‡Ð°Ñ‚Ð¸ Ð¿Ð¾ÑˆÑƒÐº",
        "btn_stop": "â›” Ð—ÑƒÐ¿Ð¸Ð½Ð¸Ñ‚Ð¸ Ð¿Ð¾ÑˆÑƒÐº",
        "btn_change_sub": "Ð—Ð¼Ñ–Ð½Ð¸Ñ‚Ð¸ Ð¿Ñ–Ð´Ñ‚ÐµÐ¼Ñƒ",
        "btn_main_menu": "ðŸ  Ð“Ð¾Ð»Ð¾Ð²Ð½Ðµ Ð¼ÐµÐ½ÑŽ",
        "btn_support": "â¤ï¸ ÐŸÑ–Ð´Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚",
        "btn_end_dialog": "âŒ Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚Ð¸ Ð´Ñ–Ð°Ð»Ð¾Ð³",
        "btn_new_partner": "ðŸ” ÐÐ¾Ð²Ð¸Ð¹ ÑÐ¿Ñ–Ð²Ñ€Ð¾Ð·Ð¼Ð¾Ð²Ð½Ð¸Ðº",
        "pls_start": "Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð½Ð°Ð´Ñ–ÑˆÐ»Ñ–Ñ‚ÑŒ /start.",
        "btn_end": "âŒ Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚Ð¸ Ð´Ñ–Ð°Ð»Ð¾Ð³",

        "gender_male": "Ð§Ð¾Ð»Ð¾Ð²Ñ–Ñ‡Ð°",
        "gender_female": "Ð–Ñ–Ð½Ð¾Ñ‡Ð°",
        "gender_any": "ÐÐµÐ²Ð°Ð¶Ð»Ð¸Ð²Ð¾",
    },
    "en": {
        "choose_lang": "ðŸŒ Please choose your language:",
        "welcome_back": "ðŸ‘‹ Welcome back, {name}!",
        "enter_nick": "ðŸ‘‹ Hi! Enter your nickname:",
        "pick_theme": "Choose a topic:",
        "choose_sub": "Now choose a subtopic:",
        "pick_sub": "Select a new subtopic:",
        "wrong_sub": "Please select a subtopic from the list.",
        "choose_gender": "Select your gender:",
        "wrong_gender": "Please select your gender:",
        "found": "ðŸŽ‰ Partner found!\nTopic: {theme}\nSubtopic: {sub}\nPartner language: {lang}",
        "main_menu": "Choose an action:",
        "searching": "ðŸ”Ž Looking for a partner...",
        "default_searching": "â³ Still looking for a partner...",
        "search_stopped": "Search stopped.",
        "error_fallback": "âŒ Something went wrong. Please send /start.",
        "sub_any": "Any subtopic",
        "support_thanks": "ðŸ™ Thanks for your support!\n(A donation link will appear here)",

        "btn_start": "Start",
        "btn_search": "ðŸ” Start search",
        "btn_stop": "â›” Stop search",
        "btn_change_sub": "Change subtopic",
        "btn_main_menu": "ðŸ  Main menu",
        "btn_support": "â¤ï¸ Support the project",
        "btn_end_dialog": "âŒ End chat",
        "btn_new_partner": "ðŸ” New partner",
        "pls_start": "Please send /start.",
        "btn_end": "âŒ End chat",

        "gender_male": "Male",
        "gender_female": "Female",
        "gender_any": "Doesn't matter",
    },
    "es": {
        "choose_lang": "ðŸŒ Por favor, elige un idioma:",
        "welcome_back": "ðŸ‘‹ Â¡Bienvenido de nuevo, {name}!",
        "enter_nick": "ðŸ‘‹ Â¡Hola! Escribe tu apodo:",
        "pick_theme": "Elige un tema:",
        "choose_sub": "Ahora elige un subtema:",
        "pick_sub": "Elige un nuevo subtema:",
        "wrong_sub": "Por favor, elige un subtema de la lista.",
        "choose_gender": "Selecciona tu gÃ©nero:",
        "wrong_gender": "Por favor, selecciona tu gÃ©nero:",
        "found": "ðŸŽ‰ Â¡Pareja encontrada!\nTema: {theme}\nSubtema: {sub}\nIdioma del interlocutor: {lang}",
        "main_menu": "Elige una acciÃ³n:",
        "searching": "ðŸ”Ž Buscando compaÃ±ero...",
        "default_searching": "â³ Buscando compaÃ±ero...",
        "search_stopped": "BÃºsqueda detenida.",
        "error_fallback": "âŒ Algo saliÃ³ mal. Escribe /start.",
        "sub_any": "Cualquier subtema",
        "support_thanks": "ðŸ™ Â¡Gracias por tu apoyo!\n(AquÃ­ aparecerÃ¡ el enlace de donaciÃ³n)",

        "btn_start": "Comenzar",
        "btn_search": "ðŸ” Buscar",
        "btn_stop": "â›” Detener bÃºsqueda",
        "btn_change_sub": "Cambiar subtema",
        "btn_main_menu": "ðŸ  MenÃº principal",
        "btn_support": "â¤ï¸ Apoyar el proyecto",
        "btn_end_dialog": "âŒ Terminar chat",
        "btn_new_partner": "ðŸ” Nueva pareja",
        "pls_start": "Por favor, envÃ­a /start.",
        "btn_end": "âŒ Terminar chat",

        "gender_male": "Masculino",
        "gender_female": "Femenino",
        "gender_any": "No importa",
    },
    "fr": {
        "choose_lang": "ðŸŒ Veuillez choisir votre langueÂ :",
        "welcome_back": "ðŸ‘‹ Bon retour, {name}Â !",
        "enter_nick": "ðŸ‘‹ SalutÂ ! Entrez votre pseudoÂ :",
        "pick_theme": "Choisissez un thÃ¨meÂ :",
        "choose_sub": "Choisis maintenant une sous-thÃ¨meÂ :",
        "pick_sub": "Choisissez une nouvelle sous-thÃ¨meÂ :",
        "wrong_sub": "Veuillez choisir une sous-thÃ¨me dans la liste.",
        "choose_gender": "Indique ton sexeÂ :",
        "wrong_gender": "Veuillez choisir votre sexeÂ :",
        "found": "ðŸŽ‰ Partenaire trouvÃ©â€¯!\nThÃ¨meÂ : {theme}\nSousâ€‘thÃ¨meÂ : {sub}\nLangue du partenaireÂ : {lang}",
        "main_menu": "Choisissez une actionÂ :",
        "searching": "ðŸ”Ž Recherche dâ€™un partenaire...",
        "default_searching": "â³ Recherche en cours...",
        "search_stopped": "Recherche arrÃªtÃ©e.",
        "error_fallback": "âŒ Une erreur est survenue. Envoyez /start.",
        "sub_any": "Nâ€™importe quel sous-thÃ¨me",
        "support_thanks": "ðŸ™ Merci pour votre soutien !\n(Un lien de don apparaÃ®tra ici)",

        "btn_start": "Commencer",
        "btn_search": "ðŸ” Lancer la recherche",
        "btn_stop": "â›” ArrÃªter la recherche",
        "btn_change_sub": "Changer le sousâ€‘thÃ¨me",
        "btn_main_menu": "ðŸ  Menu principal",
        "btn_support": "â¤ï¸ Soutenir le projet",
        "btn_end_dialog": "âŒ Terminer la discussion",
        "btn_new_partner": "ðŸ” Nouveau partenaire",
        "pls_start": "Veuillez envoyer /start.",
        "btn_end": "âŒ Terminer la discussion",

        "gender_male": "Homme",
        "gender_female": "Femme",
        "gender_any": "Peu importe",
    },
    "de": {
        "choose_lang": "ðŸŒ Bitte wÃ¤hle eine Sprache:",
        "welcome_back": "ðŸ‘‹ Willkommen zurÃ¼ck, {name}!",
        "enter_nick": "ðŸ‘‹ Hallo! Gib deinen Nick ein:",
        "pick_theme": "WÃ¤hle ein Thema:",
        "choose_sub": "WÃ¤hle jetzt ein Unterthema:",
        "pick_sub": "WÃ¤hle ein neues Unterthema:",
        "wrong_sub": "Bitte wÃ¤hle ein Unterthema aus der Liste.",
        "choose_gender": "WÃ¤hle dein Geschlecht:",
        "wrong_gender": "Bitte wÃ¤hle dein Geschlecht:",
        "found": "ðŸŽ‰ GesprÃ¤chspartner gefunden!\nThema: {theme}\nUnterthema: {sub}\nSprache des Partners: {lang}",
        "main_menu": "WÃ¤hle eine Aktion:",
        "searching": "ðŸ”Ž Suche nach GesprÃ¤chspartner...",
        "default_searching": "â³ Suche lÃ¤uft...",
        "search_stopped": "Suche gestoppt.",
        "error_fallback": "âŒ Etwas ist schiefgelaufen. Sende /start.",
        "sub_any": "Beliebiges Unterthema",
        "support_thanks": "ðŸ™ Vielen Dank fÃ¼r deine UnterstÃ¼tzung!\n(Hier erscheint ein Spendenlink)",

        "btn_start": "Start",
        "btn_search": "ðŸ” Suche starten",
        "btn_stop": "â›” Suche stoppen",
        "btn_change_sub": "Unterthema Ã¤ndern",
        "btn_main_menu": "ðŸ  HauptmenÃ¼",
        "btn_support": "â¤ï¸ Projekt unterstÃ¼tzen",
        "btn_end_dialog": "âŒ GesprÃ¤ch beenden",
        "btn_new_partner": "ðŸ” Neuer Partner",
        "pls_start": "Bitte sende /start.",
        "btn_end": "âŒ Chat beenden",

        "gender_male": "MÃ¤nnlich",
        "gender_female": "Weiblich",
        "gender_any": "Egal",
    },
}

def tr_lang(lang: str, key: str, **kw) -> str:
    lang = lang if lang in TEXTS else "ru"
    return TEXTS[lang].get(key, key).format(**kw)

async def tr(user, key: str, **kw) -> str:
    lang = "ru"
    if isinstance(user, dict):
        lang = user.get("lang", "ru")
    elif hasattr(user, "id"):
        from db.user_queries import get_user
        row = await get_user(user.id)
        if row:
            lang = row.get("lang", "ru")
    return tr_lang(lang, key, **kw)
